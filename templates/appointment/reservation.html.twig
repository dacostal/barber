{% extends 'base.html.twig' %}

{% block stylesheets %}
    <link href="{{ asset('css/new_appointment.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.5.1/main.min.css"
          integrity="sha256-uq9PNlMzB+1h01Ij9cx7zeE2OR2pLAfRw3uUUOOPKdA=" crossorigin="anonymous">
{% endblock %}

{% block body %}

    <div id="new-app" class="w-75 mx-auto">
        <label for="barbers">Préférence barbier</label>

        <select class="custom-select w-25" name="barbers" id="barbers">
            <option disabled selected value="">-- sélectionnez un barbier --</option>
            {% for b in barbers %}
                <option value="{{ b.id }}">{{ b.firstName }}</option>
            {% endfor %}
        </select>

        <div id="availabilities" class="jumbotron">

        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {#}<script src="{{ asset('js/newapp_calendar.js') }}"></script>{#}
    <script>
        window.onload = () => {
            let availabilities = document.querySelector("#availabilities");

            let calendar = new FullCalendar.Calendar(availabilities, {
                initialView: 'dayGridWeek',
                locale: 'fr',
                timeZone: 'Europe/Paris',
                firstDay: (new Date().getDay()),
                themeSystem: 'bootstrap',
                headerToolbar: {
                    start: 'prev,next',
                    center: 'title',
                    end: 'today'
                },
                buttonText: {
                    today: 'Aujourd\'hui'
                },
                events: function(start, end, callback) {
                    fetch('/reservation/' + getUrlId())
                        .then((resp) => resp.json()) // Transform the JSON data into a variable
                        .then(function(data) {
                            var eventsList = [];
                            for (var i = 0; i < data.events.length; i++) {
                                var event = {
                                    daysOfWeek: data.events[i].daysOfWeek,
                                    startTime: data.events[i].startTime,
                                    endTime: data.events[i].endTime,
                                };
                                eventsList.push(event);
                            }
                            callback(eventsList);
                        });
                },
                eventTimeFormat: {
                    hour: 'numeric',
                    minute: '2-digit'
                }
            });

            calendar.render();
        }

        function getUrlId(){
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
        }

        function ajaxEventsById(){
            $.ajax({
                url : 'reservation/' + getUrlId(),
                type : 'GET',
                dataType : 'json',
                success : function(events){ // success est toujours en place, bien sûr !
                    return events;
                },
                error : function(resultat, statut, erreur){

                }
            });
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.5.1/main.min.js"
            integrity="sha256-rPPF6R+AH/Gilj2aC00ZAuB2EKmnEjXlEWx5MkAp7bw=" crossorigin="anonymous"></script>
{% endblock %}
